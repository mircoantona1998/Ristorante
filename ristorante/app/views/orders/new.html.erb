<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nuovo Ordine</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/css/bootstrap.min.css">
  <script>
  document.addEventListener('DOMContentLoaded', function () {
    const tableSelect = document.getElementById('order_table_id');
    const submitButton = document.querySelector('input[type="submit"]');
    
    function toggleSubmitButton() {
      submitButton.disabled = !tableSelect.value;
    }
    
    tableSelect.addEventListener('change', toggleSubmitButton);
    toggleSubmitButton();  

    document.querySelectorAll('.form-check-input').forEach(function (checkbox) {
      checkbox.addEventListener('change', function () {
        const quantityField = document.getElementById('quantity_' + this.value);
        const quantityInput = quantityField.querySelector('input');
        
        if (this.checked) {
          quantityField.style.display = 'block';
          quantityInput.setAttribute('required', 'required');
        } else {
          quantityField.style.display = 'none';
          quantityInput.removeAttribute('required');
        }
      });
    });
  });
</script>
</head>
<body>
<div class="container">
  <h1>Nuovo Ordine</h1>
  
  <% if @tables.empty? %>
    <div class="alert alert-warning" role="alert">
      Nessun tavolo disponibile. Non puoi creare un ordine.
    </div>
  <% else %>
    <%= form_with model: @order, url: orders_path, method: :post do |f| %>
      <div class="mb-3">
        <%= f.label :table_id, 'Seleziona un Tavolo', class: 'form-label' %>
        <%= f.collection_select :table_id, @tables, :id, :numero, prompt: 'Scegli un tavolo', class: 'form-select' %>
      </div>
    
      <div class="mb-3">
        <h3>Seleziona le Portate</h3>
        <% @broughts.each do |brought| %>
          <div class="form-check">
            <%= check_box_tag "brought_ids[]", brought.id, false, id: "brought_#{brought.id}", class: 'form-check-input' %>
            <%= label_tag "brought_#{brought.id}", brought.nome, class: 'form-check-label' %>
            <div class="quantity-input" id="quantity_<%= brought.id %>">
              <%= number_field_tag "quantities[#{brought.id}]", 1, min: 1, step: 1, class: 'form-control d-inline', style: 'width: auto;' %>
            </div>
          </div>
        <% end %>
      </div>
    
      <div class="mt-3">
        <%= f.submit 'Crea Ordine', class: 'btn btn-primary' %>
      </div>
    <% end %>
  <% end % %>
  
  <div class="mt-3">
    <%= link_to 'Annulla', orders_path, class: 'btn btn-secondary' %>
  </div>
  
    <%= link_to '<i class="fas fa-home"></i>'.html_safe, root_path, class: 'home-button' %>
</div>
</body>
</html>
